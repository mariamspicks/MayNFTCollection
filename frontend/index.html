<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>May NFT Collection - Mint</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .nft-preview {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 2px solid #ffc107;
        }
        .config-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        .config-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .info-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .info-value {
            color: #333;
            font-size: 1.3em;
            font-weight: bold;
        }
        .mint-controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .quantity-btn {
            width: 50px;
            height: 50px;
            border: none;
            background: #667eea;
            color: white;
            font-size: 1.5em;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }
        .quantity-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: scale(1.1);
        }
        .quantity-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .quantity-display {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            min-width: 60px;
            text-align: center;
        }
        .total-cost {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }
        .total-cost strong {
            color: #667eea;
            font-size: 1.4em;
        }
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        .wallet-info {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .wallet-address {
            color: #667eea;
            font-family: monospace;
            font-size: 0.9em;
            word-break: break-all;
        }
        .owned-nfts {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }
        .nft-token {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 500;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .loading { text-align: center; padding: 20px; }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® May NFT Collection</h1>
        <p class="subtitle">Mint your unique digital collectible</p>

        <div class="config-section">
            <h3>‚öôÔ∏è Contract Configuration</h3>
            <input type="text" id="contractAddress" class="config-input" 
                   placeholder="Contract Address (0x...)" 
                   value="0x8B94546b97104Dd16230bf5B70470cA1739eF209">
            <button onclick="updateContract()" class="btn btn-secondary">Update Contract</button>
        </div>

        <div class="nft-preview">Your NFT Preview</div>

        <div class="info-grid">
            <div class="info-box">
                <div class="info-label">Total Supply</div>
                <div class="info-value" id="maxSupply">-</div>
            </div>
            <div class="info-box">
                <div class="info-label">Minted</div>
                <div class="info-value" id="currentSupply">-</div>
            </div>
            <div class="info-box">
                <div class="info-label">Mint Price</div>
                <div class="info-value" id="mintPrice">-</div>
            </div>
            <div class="info-box">
                <div class="info-label">Max Per Wallet</div>
                <div class="info-value" id="maxPerWallet">-</div>
            </div>
        </div>

        <div id="connectSection">
            <button onclick="connectWallet()" class="btn btn-primary">ü¶ä Connect MetaMask</button>
        </div>

        <div id="mintSection" class="hidden">
            <div class="wallet-info">
                <div>Connected Wallet:</div>
                <div class="wallet-address" id="walletAddress"></div>
                <div style="margin-top: 10px;">
                    <strong>Balance:</strong> <span id="userBalance">0 ETH</span>
                </div>
                <div>
                    <strong>You Own:</strong> <span id="ownedCount">0 NFTs</span>
                </div>
            </div>

            <div class="mint-controls">
                <div class="quantity-selector">
                    <button onclick="decreaseQuantity()" class="quantity-btn">‚àí</button>
                    <div class="quantity-display" id="quantity">1</div>
                    <button onclick="increaseQuantity()" class="quantity-btn">+</button>
                </div>
                <div class="total-cost">
                    Total: <strong id="totalCost">0 ETH</strong>
                </div>
                <button onclick="mintNFT()" class="btn btn-primary" id="mintBtn">üé® Mint NFT</button>
            </div>

            <div class="owned-nfts hidden" id="ownedSection">
                <h3>Your NFTs</h3>
                <div class="nft-grid" id="nftGrid"></div>
            </div>
        </div>

        <div id="statusMessage"></div>
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p style="margin-top: 10px;">Processing transaction...</p>
        </div>
    </div>

    <script>
        const CONTRACT_ABI = [
            "function mint() external payable",
            "function mintBatch(uint256 quantity) external payable",
            "function getCurrentSupply() external view returns (uint256)",
            "function mintPrice() external view returns (uint256)",
            "function maxSupply() external view returns (uint256)",
            "function maxPerWallet() external view returns (uint256)",
            "function mintingPaused() external view returns (bool)",
            "function balanceOf(address owner) external view returns (uint256)",
            "function tokensOfOwner(address owner) external view returns (uint256[])",
            "function mintedPerWallet(address owner) external view returns (uint256)"
        ];

        let provider, signer, contract, userAddress, currentQuantity = 1, mintPriceWei;
        let contractAddress = "0x8B94546b97104Dd16230bf5B70470cA1739eF209";

        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showStatus('Please install MetaMask!', 'error');
                    return;
                }

                showStatus('Connecting to wallet...', 'info');
                provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();
                contract = new ethers.Contract(contractAddress, CONTRACT_ABI, signer);

                document.getElementById('connectSection').classList.add('hidden');
                document.getElementById('mintSection').classList.remove('hidden');
                document.getElementById('walletAddress').textContent = 
                    userAddress.substring(0, 6) + '...' + userAddress.substring(38);

                await loadContractData();
                showStatus('Wallet connected successfully!', 'success');
            } catch (error) {
                console.error(error);
                showStatus('Failed to connect: ' + error.message, 'error');
            }
        }

        async function loadContractData() {
            try {
                const [maxSupply, currentSupply, mintPrice, maxPerWallet, mintingPaused, userBalance, ownedCount] = 
                    await Promise.all([
                        contract.maxSupply(),
                        contract.getCurrentSupply(),
                        contract.mintPrice(),
                        contract.maxPerWallet(),
                        contract.mintingPaused(),
                        provider.getBalance(userAddress),
                        contract.balanceOf(userAddress)
                    ]);

                mintPriceWei = mintPrice;

                document.getElementById('maxSupply').textContent = maxSupply.toString();
                document.getElementById('currentSupply').textContent = currentSupply.toString();
                document.getElementById('mintPrice').textContent = ethers.formatEther(mintPrice) + ' ETH';
                document.getElementById('maxPerWallet').textContent = maxPerWallet.toString();
                document.getElementById('userBalance').textContent = 
                    parseFloat(ethers.formatEther(userBalance)).toFixed(4) + ' ETH';
                document.getElementById('ownedCount').textContent = ownedCount.toString() + ' NFTs';

                if (mintingPaused) {
                    showStatus('‚ö†Ô∏è Minting is currently paused!', 'info');
                    document.getElementById('mintBtn').disabled = true;
                } else {
                    document.getElementById('mintBtn').disabled = false;
                }

                if (ownedCount > 0) {
                    await loadOwnedNFTs();
                }

                updateTotalCost();
            } catch (error) {
                console.error(error);
                showStatus('Failed to load contract data: ' + error.message, 'error');
            }
        }

        async function loadOwnedNFTs() {
            try {
                const tokenIds = await contract.tokensOfOwner(userAddress);
                
                if (tokenIds.length > 0) {
                    document.getElementById('ownedSection').classList.remove('hidden');
                    const grid = document.getElementById('nftGrid');
                    grid.innerHTML = '';
                    
                    tokenIds.forEach(tokenId => {
                        const nftBox = document.createElement('div');
                        nftBox.className = 'nft-token';
                        nftBox.textContent = '#' + tokenId.toString();
                        grid.appendChild(nftBox);
                    });
                }
            } catch (error) {
                console.error('Failed to load owned NFTs:', error);
            }
        }

        function increaseQuantity() {
            if (currentQuantity < 5) {
                currentQuantity++;
                document.getElementById('quantity').textContent = currentQuantity;
                updateTotalCost();
            }
        }

        function decreaseQuantity() {
            if (currentQuantity > 1) {
                currentQuantity--;
                document.getElementById('quantity').textContent = currentQuantity;
                updateTotalCost();
            }
        }

        function updateTotalCost() {
            if (mintPriceWei) {
                const total = mintPriceWei * BigInt(currentQuantity);
                document.getElementById('totalCost').textContent = ethers.formatEther(total) + ' ETH';
            }
        }

        async function mintNFT() {
            try {
                document.getElementById('loading').classList.remove('hidden');
                document.getElementById('mintBtn').disabled = true;
                showStatus('Preparing transaction...', 'info');

                const totalCost = mintPriceWei * BigInt(currentQuantity);
                
                let tx;
                if (currentQuantity === 1) {
                    tx = await contract.mint({ value: totalCost });
                } else {
                    tx = await contract.mintBatch(currentQuantity, { value: totalCost });
                }

                showStatus('Transaction submitted! Waiting for confirmation...', 'info');
                await tx.wait();
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mintBtn').disabled = false;
                showStatus(`Successfully minted ${currentQuantity} NFT(s)! üéâ`, 'success');
                
                await loadContractData();
            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mintBtn').disabled = false;
                
                console.error(error);
                let errorMessage = 'Minting failed: ';
                
                if (error.message.includes('user rejected')) {
                    errorMessage += 'Transaction was rejected';
                } else if (error.message.includes('insufficient funds')) {
                    errorMessage += 'Insufficient funds';
                } else {
                    errorMessage += error.message;
                }
                
                showStatus(errorMessage, 'error');
            }
        }

        function updateContract() {
            const input = document.getElementById('contractAddress').value.trim();
            
            if (!input || !ethers.isAddress(input)) {
                showStatus('Invalid contract address', 'error');
                return;
            }
            
            contractAddress = input;
            showStatus('Contract address updated!', 'success');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                if (type === 'success' || type === 'info') {
                    statusDiv.style.display = 'none';
                }
            }, 5000);
        }
    </script>
</body>
</html>
